{% extends 'base.html' %}

{% block title %}Reconnaissance Âge et Sexe{% endblock %}

{% block content %}
<div class="result-container" style="margin: auto; width: 80%; padding: 20px;">
    <h1>Résultats de l'Analyse Âge et Sexe</h1>
    <div class="image-container" style="text-align: center; margin-bottom: 20px;">
        <img id="result-image" src="data:image/jpeg;base64,{{ image_base64 }}" alt="Image analysée" style="width: 400px; height: auto;">
    </div>
    {% if ages_et_sexes %}
        {% if ages_et_sexes[0]['message'] is defined %}
            <p>{{ ages_et_sexes[0]['message'] }}</p>
        {% else %}
            {% for age_sexe in ages_et_sexes %}
                <div>
                    <h2>Visage {{ loop.index }}</h2>
                    {% if 'age' in age_sexe %}
                        <p>Âge: {{ age_sexe['age'] }}</p>
                    {% endif %}
                    {% if 'dominant_gender' in age_sexe %}
                        {% set gender_translation = {'Man': 'Homme', 'Woman': 'Femme'} %}
                        <p>Sexe: {{ gender_translation[age_sexe['dominant_gender']] }} (Homme: {{ age_sexe['gender']['Man'] }}%, Femme: {{ age_sexe['gender']['Woman'] }}%)</p>
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    {% else %}
        <p>Aucun résultat disponible.</p>
    {% endif %}
        <div style="margin-top: 20px;">
        <form action="/soumettre_avis_age_genre" method="post">
            <p>Votre avis sur ces résultats :</p>
            <div>
                <input type="radio" id="bon" name="feedback" value="bon" required>
                <label for="bon">Bon</label>
            </div>
            <div>
                <input type="radio" id="faux" name="feedback" value="faux">
                <label for="faux">Faux</label>
            </div>
            <button type="submit" style="margin-top: 10px;">Soumettre Avis</button>
        </form>
    </div>
    <div style="text-align: center; margin-top: 20px;">
        <button onclick="downloadImage()" class="btn btn-primary">Télécharger l'image</button>
    </div>
    <div style="text-align: center; margin-top: 20px;">
         <button onclick="window.location.href='/menureconnaissanceagesexe'" type="submit" style="margin-top: 10px;">Retour</button>
    </div>
</div>

<script>
    function downloadImage() {
        const image = document.getElementById('result-image');
        const link = document.createElement('a');
        link.href = image.src;
        link.download = 'image_modifiee.jpg';
        link.click();
    }
</script>

{% endblock %}
